<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Справка - GitGemini Pro</title>
    <style>
        html, body {
            margin: 0; padding: 0; font-family: sans-serif;
            background-color: #2b2b2b; color: #d0d0d0; font-size: 14px;
        }
        body { padding: 15px; line-height: 1.6; }
        h1, h2, h3 {
            color: #87ceeb; border-bottom: 1px solid #555;
            padding-bottom: 5px; margin-top: 1.5em; margin-bottom: 0.8em;
        }
        h1 { margin-top: 0.5em; }
        ul, ol { margin-top: 0.5em; margin-bottom: 0.8em; padding-left: 30px; }
        li { margin-bottom: 0.5em; }
        code {
            background-color: #444; color: #ccc; padding: 2px 5px;
            border-radius: 3px; font-family: Consolas, 'Courier New', monospace;
            font-size: 0.95em;
        }
        .shortcut { font-weight: bold; color: #98fb98; }
        a { color: #66d9ef; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .important {
            background-color: rgba(255, 235, 59, 0.1); /* Желтоватый фон */
            border-left: 4px solid #ffeb3b; /* Желтая полоса слева */
            padding: 10px 15px;
            margin: 1em 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>Справка по GitGemini Pro</h1>

    <h2>Назначение программы</h2>
    <p>
        <b>GitGemini Pro</b> — это интеллектуальный ассистент для работы с кодовой базой проектов, размещенных на GitHub. Программа позволяет вести диалог с языковой моделью Google Gemini, используя файлы вашего репозитория в качестве контекста.
    </p>
    <p>
        Вместо того чтобы передавать все файлы целиком, GitGemini Pro использует современный подход **RAG (Retrieval-Augmented Generation)** на основе семантического векторного поиска. Это позволяет предоставлять более точные и релевантные ответы, экономя при этом ресурсы API.
    </p>

    <h2>Принцип работы: RAG и Векторный Поиск</h2>
    <p>Работа с программой состоит из двух основных этапов:</p>
    <ol>
        <li>
            <b>Анализ (Индексация):</b> Когда вы нажимаете "Анализировать репозиторий", программа выполняет следующие действия:
            <ul>
                <li>Она читает каждый файл, подходящий по расширению.</li>
                <li>Каждый файл разбивается на небольшие, логически связанные фрагменты (чанки).</li>
                <li>Для каждого файла создается краткое описание (саммари).</li>
                <li>И чанки, и саммари преобразуются в числовые векторы (эмбеддинги) с помощью локальной нейросети. Эти векторы отражают семантический смысл текста.</li>
                <li>Все векторы и соответствующие им тексты сохраняются в локальную векторную базу данных (`ChromaDB`).</li>
            </ul>
        </li>
        <li>
            <b>Диалог (Запрос и Ответ):</b> Когда вы задаете вопрос:
            <ul>
                <li>Ваш вопрос тоже преобразуется в вектор.</li>
                <li>Программа ищет в векторной базе данных те фрагменты, чьи векторы наиболее "близки" к вектору вашего вопроса. Это позволяет найти информацию, релевантную по смыслу, а не только по ключевым словам.</li>
                <li>Найденные самые релевантные фрагменты собираются вместе и формируют контекст.</li>
                <li>Этот контекст, вместе с вашим вопросом и историей чата, отправляется модели Gemini для генерации ответа.</li>
            </ul>
        </li>
    </ol>
    <p>
        Этот подход позволяет "подавать" языковой модели только самую нужную информацию из всего проекта, что делает ответы быстрыми, точными и экономичными.
    </p>

    <h2>Первый запуск: Настройка</h2>
    <p>Для первого запуска необходимо выполнить три обязательных шага по настройке.</p>
    
    <h3>Шаг 1: Загрузка модели для семантического поиска</h3>
    <div class="important">
        <p><strong>Важно:</strong> Для преобразования текстов в векторы (эмбеддинги) программа использует локальную ONNX-модель `all-MiniLM-L6-v2`. Поскольку большие файлы не хранятся в репозитории, ее необходимо скачать вручную один раз.</p>
        <ol>
            <li>В корневой папке проекта создайте новую структуру папок с именем <code>resources/models/onnx_model</code>.</li>
            <li>Перейдите на страницу модели в Hugging Face по <a href="https://huggingface.co/sentence-transformers/all-MiniLM-L6-v2/tree/main/onnx">этой ссылке</a>.</li>
            <li>Найдите файл <code>model.onnx</code> и скачайте его (нажмите на иконку со стрелкой вниз).</li>
            <li>Поместите скачанный файл в созданную вами папку <code>resources/models/onnx_model</code>.</li>
        </ol>
    </div>

    <h3>Шаг 2: Настройка ключей доступа</h3>
    <div class="important">
        <p>Для работы программы требуются два ключа:</p>
        <ul>
            <li><b>Gemini API Key:</b> Ваш ключ для доступа к моделям Google Gemini. Его можно получить в <a href="https://makersuite.google.com/app/apikey">Google AI Studio</a>.</li>
            <li><b>GitHub Personal Access Token (PAT):</b> Токен для доступа к репозиториям через API GitHub.</li>
        </ul>
    </div>
    <h4>Как создать GitHub PAT:</h4>
    <ol>
        <li>Перейдите в настройки вашего аккаунта GitHub: <a href="https://github.com/settings/tokens">Tokens (classic)</a>.</li>
        <li>Нажмите "Generate new token" -> "Generate new token (classic)".</li>
        <li>Дайте токену имя (например, "GitGeminiPro").</li>
        <li>Установите срок действия (Expiration).</li>
        <li>В разделе "Select scopes", поставьте галочку напротив <code>repo</code>. Это предоставит доступ к вашим репозиториям, включая приватные.</li>
        <li>Нажмите "Generate token". <b>Скопируйте токен немедленно!</b> Вы больше не сможете его увидеть.</li>
    </ol>
    <p>
        После получения ключей введите их в соответствующие поля в разделе "Настройки" и нажмите "Сохранить". Ключи будут сохранены локально в файл <code>.env</code>.
    </p>

    <h3>Шаг 3: Компиляция грамматик Tree-sitter (для анализа кода)</h3>
    <div class="important">
        <p>
            Для интеллектуального разбиения кода на основе синтаксиса GitGemini Pro использует библиотеку Tree-sitter. Вам необходимо скомпилировать необходимые грамматики один раз.
        </p>
        <ol>
            <li>В корневой папке проекта создайте новую папку с именем <code>grammars</code>.</li>
            <li>Склонируйте репозитории с нужными грамматиками в папку <code>grammars</code>. Рекомендуемый набор включает:
                <ul>
                    <li><code>git clone https://github.com/tree-sitter/tree-sitter-python</code></li>
                    <li><code>git clone https://github.com/tree-sitter/tree-sitter-javascript</code></li>
                    <li><code>git clone https://github.com/tree-sitter/tree-sitter-html</code></li>
                    <li><code>git clone https://github.com/tree-sitter/tree-sitter-css</code></li>
                    <li><code>git clone https://github.com/tree-sitter/tree-sitter-json</code></li>
                    <li><code>git clone https://github.com/tree-sitter/tree-sitter-java</code></li>
                    <li><code>git clone https://github.com/tree-sitter/tree-sitter-c-sharp</code></li>
                    <li><code>git clone https://github.com/tree-sitter/tree-sitter-cpp</code></li>
                    <li><code>git clone https://github.com/tree-sitter/tree-sitter-go</code></li>
                    <li><code>git clone https://github.com/tree-sitter/tree-sitter-ruby</code></li>
                    <li><code>git clone https://github.com/tree-sitter/tree-sitter-rust</code></li>
                    <li><code>git clone https://github.com/tree-sitter/tree-sitter-bash</code></li>
                    <li><code>git clone https://github.com/ikatyang/tree-sitter-yaml</code></li>
                    <!-- Примечание: tree-sitter-typescript, tree-sitter-php, tree-sitter-sql исключены из-за проблем с компиляцией на Windows. -->
                </ul>
            </li>
            <li>Убедитесь, что у вас установлены <b>инструменты сборки C/C++</b> для вашей операционной системы:
                <ul>
                    <li><b>Windows:</b> Установите "Build Tools for Visual Studio" (рабочая нагрузка "Разработка классических приложений на C++"). Затем откройте <b>"x64 Native Tools Command Prompt for VS 2022"</b>.</li>
                    <li><b>Linux (Debian/Ubuntu):</b> <code>sudo apt-get install build-essential</code></li>
                    <li><b>macOS:</b> <code>xcode-select --install</code></li>
                </ul>
            </li>
            <li>В вашем активированном виртуальном окружении Python, из корневого каталога проекта, запустите скрипт компиляции:
                <pre><code>python build_grammars.py</code></pre>
            </li>
            <li>Это создаст единый файл библиотеки (например, <code>languages.dll</code>) в папке <code>resources/grammars</code>. Этот файл необходим для интеллектуального анализа кода.</li>
        </ol>
        <p>
            Если какую-либо грамматику не удается скомпилировать (например, из-за специфических сложностей на Windows), приложение автоматически переключится на более простой метод разбиения по символам для файлов этого языка. Основная функциональность останется неизменной.
        </p>
    </div>

    <h2>Основные элементы интерфейса</h2>
    <ul>
        <li><b>URL Репозитория GitHub:</b> Поле для вставки URL вашего репозитория (например, <code>https://github.com/пользователь/репозиторий</code>).</li>
        <li><b>Выбор ветки:</b> Выпадающий список, который автоматически заполняется ветками указанного репозитория. Позволяет выбрать конкретную ветку для анализа.</li>
        <li><b>Анализировать репозиторий:</b> Кнопка запускает процесс индексации (создания векторной базы).</li>
        <li><b>Отмена анализа:</b> Позволяет остановить процесс индексации.</li>
        <li><b>Просмотр саммари (кнопка 👁️):</b> Открывает отдельное окно, где можно увидеть список всех проанализированных файлов и их краткие описания (саммари), созданные ИИ. Окно имеет функцию поиска по имени файла.</li>
        <li><b>Настройки (сворачиваемая панель):</b>
            <ul>
                <li><b>Ключ API / Токен GitHub:</b> Поля для ввода и сохранения ваших ключей доступа.</li>
                <li><b>Модель ИИ:</b> Выпадающий список для выбора модели Gemini.</li>
                <li><b>Макс. токенов ответа:</b> Ограничение на длину ответа модели.</li>
                <li><b>Расширения файлов:</b> Чекбоксы для выбора типов файлов, которые будут включены в анализ.</li>
            </ul>
        </li>
        <div class="important">
            <p><strong>Совет:</strong> Если вы сталкиваетесь с ошибками, связанными с квотами (quota exceeded) или временной недоступностью модели, попробуйте изменить модель ИИ в настройках. Например, переключитесь с более мощной версии (gemini-1.5-pro) на более быструю (gemini-1.5-flash) или наоборот. Иногда это помогает обойти временные ограничения на стороне API.</p>
        </div>
        <li><b>Инструкции (сворачиваемая панель):</b> Поле для системных инструкций и управление шаблонами.</li>
        <li><b>Диалог:</b> Область отображения истории переписки.
            <ul>
                <li>Серым курсивом отображаются системные сообщения о стадиях RAG-процесса.</li>
                <li>Кнопка <code>🛇</code> / <code>👁</code> справа от сообщения: Исключает/включает сообщение из контекста.</li>
            </ul>
        </li>
        <li><b>Ваш запрос:</b> Поле для ввода вашего сообщения модели. <span class="shortcut">Ctrl+Enter</span> отправляет запрос.</li>
        <li><b>Отправить / Отмена:</b> Кнопки для отправки запроса или его отмены.</li>
        <li><b>Строка состояния:</b> Отображает сообщения о статусе, прогресс анализа и количество токенов.</li>
    </ul>

    <h2>Меню</h2>
    <ul>
        <li><b>Файл:</b> Стандартные действия для управления сессиями (Новая, Открыть, Сохранить, Выход).
            <div class="important">
            <p><strong>Важно о сессиях:</strong> При сохранении сессии (например, `my-session`) создаются два элемента:</p>
            <ul>
                <li>Файл <code>my-session.gpcs</code>, который хранит историю чата и настройки.</li>
                <li>Папка <code>my-session_vectordb</code>, которая содержит векторную базу данных для этого проекта.</li>
            </ul>
            <p>Для переноса или архивации сессии необходимо копировать **и файл, и папку**.</p>
            </div>
        </li>
        <li><b>Справка:</b> Открывает это окно и информацию о программе.</li>
    </ul>

</body>
</html>